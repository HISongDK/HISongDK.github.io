---
title: NodeJS | Node.js 事件循环
tags: NodeJS
categories:
    - 随敲
    - NodeJS
date: 2022-02-08 11:17:09
---

## 介绍

事件循环是了解 Node.js 最重要的方面之一。

为什么这么重要？因为它阐明了 Node.js 如何做到异步并具有非阻塞的 I/O,所以它基本阐明了 Node.js 的“杀手级应用”，正是这一点使他成功了。

Node.js JavaScript 代码运行在单个线程上，每次只处理一件事。

这个限制实际上非常用用，因为它大大简化了编程方式，而不必担心并发问题。

只需要注意如何编写代码，并避免任何可能阻塞线程的事情，例如同步的网络调用或无限的循环。

通常，在大多数浏览器中，每个选项卡都有一个事件循环，以使每个进程隔离开，并避免使用无限的循环或繁重的处理来阻止整个页面。

该环境管理多个并发的事件循环，例如 处理 API 调用。Web 工作进程也运行在自己的事件循环中。

主要需要关心代码在单个事件循环上运行，并且在编写代码时牢记这一点，以避免阻塞它。

<!-- more -->

## 阻塞事件循环

任何花费太长时间才能将控制权返回给事件循环的 JavaScript 代码，都会阻塞页面中任何 JavaScript 代码的运行，甚至阻塞 UI 线程，并且用户无法单击浏览、滚动页面等。

JavaScript 中几乎所有的 I/O 基元都是非阻塞的。网络请求、文件系统操作等。被阻塞是个异常，这就是 JavaScript 如此之多基于回调（最近越来越多基于 promise 和 async/await）的原因。

## 调用堆栈

调用堆栈是一个 LIFO 队列（后进先出）

事件循环不断地检查调用堆栈，已查看是否需要运行任何函数。

当执行时，它会将找到的所有函数添加到调用堆栈中，并按照顺寻执行每个函数。

你知道在调试器或浏览器控制台中可能熟悉的错误堆栈跟踪么？浏览器在调用堆栈中查找函数名称，以告知你是哪个函数发起了当前的调用。
